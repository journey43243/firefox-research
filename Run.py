# -*- coding: utf-8 -*-
"""
Точка входа приложения

Этот модуль служит главным входом в приложение. Он инициализирует асинхронный 
цикл событий и запускает главный интерфейс приложения (Interface). Обрабатывает 
исключения при запуске и выводит соответствующие коды выхода.
"""

import sys, asyncio
from Common.Codes import ExitCode
from Interfaces.Main import Interface
from typing import NoReturn

# ----------------------------------------------------------------
# Класс для управления статусом выхода приложения
# ----------------------------------------------------------------
class ExitStatus():
    """
    Класс для хранения статуса выхода приложения.
    
    Атрибуты:
        status (int): Код выхода приложения (по умолчанию ExitCode.Ok.value).
                      Используется для информирования ОС о результате работы.
    """
    def __init__(self):
        self.status: int = ExitCode.Ok.value

# ----------------------------------------------------------------
# Главная функция приложения
# ----------------------------------------------------------------
def main() -> NoReturn:
    """
    Главная функция приложения.
    
    Инициализирует и запускает асинхронный цикл событий для выполнения 
    основной логики приложения через Interface.Run(). Обрабатывает 
    ошибки запуска асинхронного цикла и гарантирует корректный выход из приложения.
    
    Процесс:
        1. Создаёт объект ExitStatus для отслеживания кода выхода
        2. Получает асинхронный цикл событий для текущего потока
        3. Инициализирует главный интерфейс приложения
        4. Запускает асинхронную операцию Interface.Run()
        5. При успехе выходит с кодом из exitStatus
        6. При ошибке асинхронного запуска выходит с кодом AsyncStartError
    """
    exitStatus: ExitStatus = ExitStatus()
    loop: 'asyncio.windows_events.ProactorEventLoop' = asyncio.get_event_loop()
    appEntryPoint: Interface = Interface()
    # Обеспечиваем асинхронный цикл работы
    try:
        loop.run_until_complete(appEntryPoint.Run(exitStatus))
        sys.exit(exitStatus.status)
    except asyncio.exceptions.CancelledError:
        sys.exit(ExitCode.AsyncStartError.value)

# ################################################################
# Точка входа для интерпретатора Python
# ################################################################
if __name__ == '__main__':
    main()